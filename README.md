# 音声文字起こし・議事録作成ツール

Gemini 2.0 Flash モデルを使用して、音声ファイルからテキストへの文字起こしを行い、さらに議事録を自動生成するPythonツールです。日本語と英語の両方の文字起こしに対応しています。

## 対応フォーマット

以下の音声フォーマットに対応しています：

- Linear16（非圧縮PCM音声データ、WAV形式）
- FLAC（可逆圧縮形式）
- MP3形式
- OGG形式（Opusコーデック）
- WebM形式（OpusまたはVorbisコーデック）
- MP4形式（AACコーデック）
- AMR（適応マルチレートコーデック）
- AMR_WB（広帯域適応マルチレートコーデック）
- Opus（Opusコーデック）
- Speex（Speexコーデック）

## セットアップ方法

1. リポジトリをクローンまたはダウンロード

2. Python 3.7以上の環境を準備

3. 必要なライブラリをインストール
   ```
   pip install -r requirements.txt
   ```

4. Google AI Studio（https://makersuite.google.com/）でAPIキーを取得

5. `.env.example` ファイルを `.env` にコピーし、APIキーを設定
   ```
   cp .env.example .env
   ```

6. テキストエディタで `.env` を開き、`your_api_key_here` を実際のAPIキーに置き換え

## 使用方法

### コマンドラインから使用する場合

基本的な使い方：
```
python transcribe.py 音声ファイルのパス
```

例：
```
python transcribe.py sample.mp3
```

### オプション

- `-o, --output`: 文字起こし結果をファイルに保存
  ```
  python transcribe.py sample.mp3 -o result.txt
  ```

- `-m, --model`: 使用するGeminiモデルを指定（デフォルト: gemini-2.0-flash）
  ```
  python transcribe.py sample.mp3 -m gemini-2.0-flash
  ```

- `-l, --language`: 文字起こしする言語を指定（デフォルト: japanese）
  ```
  python transcribe.py sample.mp3 -l english
  ```
  
  以下の言語がサポートされています：
  - japanese（日本語）
  - english（英語）

- `-t, --timestamps`: タイムスタンプを付けて出力
  ```
  python transcribe.py sample.mp3 -t
  ```
  
  タイムスタンプは [MM:SS] または [HH:MM:SS] 形式で、各文の始まりや意味のある間の後に追加されます。

- `--minutes`: 文字起こしと同時に議事録も生成
  ```
  python transcribe.py sample.mp3 --minutes
  ```

- `--minutes-output`: 生成した議事録の保存先を指定
  ```
  python transcribe.py sample.mp3 --minutes --minutes-output meeting_minutes.md
  ```

### GUIアプリケーションを使用する場合

ファイル選択ダイアログを使用して音声ファイルを選択できるGUIアプリケーションも用意されています：

```
python transcribe_gui.py
```

GUIアプリケーションの使い方：

1. 「参照...」ボタンをクリックして、文字起こししたい音声ファイルを選択します
2. 必要に応じてオプションを変更します
   - モデル：使用するGeminiモデルを選択
   - 言語：文字起こしする言語を選択（japanese/english）
   - タイムスタンプを付ける：文字起こし結果にタイムスタンプを追加
   - 自動保存：処理後に結果を自動的にファイルに保存するかどうか
   - 議事録も生成する：文字起こしと同時に議事録も生成するかどうか
3. 「文字起こしを実行」ボタンをクリックして処理を開始します
4. 処理が完了すると、文字起こし結果と議事録が表示されます
5. 「文字起こし結果を保存」ボタンをクリックして、文字起こし結果を保存できます
6. 「議事録を保存」ボタンをクリックして、生成された議事録を保存できます

## 議事録生成機能について

本ツールは、会議などの音声を文字起こしした後、その内容を自動的に分析して議事録を作成する機能を搭載しています。

### 議事録の特徴

- マークダウン形式で作成され、見やすく整形されます
- 以下の情報を自動的に抽出・構造化します：
  - 会議情報（日時、場所、参加者、議題）
  - 議事内容（議題ごとの背景・目的、主要論点、決定事項、課題）
  - アクションアイテム（担当者、内容、期限）
  - 次回会議の情報
  - その他備考

### 議事録の形式

生成される議事録は以下のような形式になります：

```markdown
# 議事録

## 1. 会議情報
- 日時: 2024年7月1日 14:00-15:30
- 場所: 会議室A
- 参加者: 山田氏、佐藤氏、鈴木氏
- 議題: プロジェクト進捗報告、今後のスケジュール確認

## 2. 議事内容
### 2.1. 議題1: プロジェクト進捗報告
- 背景・目的: 現在の進捗状況の共有と課題の洗い出し
- 主要論点: モジュールAの開発遅延、リソース不足
- 決定事項: モジュールAのスコープ縮小を決定
- 課題/次のステップ: 優先機能の選定が必要

...

## 3. アクションアイテム
- 担当者: 山田氏
- 内容: モジュールAの優先機能リストを作成
- 期限: 7月5日まで

...

## 4. 次回会議
- 日時: 7月15日 14:00-15:00
- 場所: オンライン
- 予定議題: 優先機能の決定、リソース配分の見直し

## 5. その他・備考
リモート参加者との接続問題があったため、次回からは新しい会議システムを使用する
```

### 議事録生成のヒント

- できるだけ明確な会話が含まれた音声を使用すると、より正確な議事録が生成されます
- 会議の冒頭で参加者の名前や議題を明確に述べると、自動抽出の精度が向上します
- 議論の要点や決定事項を明確に発言すると、議事録に正確に反映されます
- 複雑な技術用語や専門用語が多い場合でも、Gemini 2.0 Flashモデルで高品質な議事録を生成できます

## 大きなファイルの処理対応

本ツールは、Google Gemini API の File API を使用して音声ファイルをアップロードするため、大きなファイルにも対応できるようになりました。以前のバージョンでは、APIリクエストのサイズ制限（20MB）によりエラーが発生することがありましたが、現在のバージョンではこの制限を回避できます。

ただし、以下の点に注意してください：

- 非常に大きなファイル（1時間以上など）は処理に時間がかかる場合があります
- Gemini APIの処理能力には上限があるため、極端に長い音声は正確に文字起こしされない可能性があります
- APIサービスの制限により、過度に大きなファイル（数百MB以上）では処理が失敗する場合があります

## 注意事項

- 大きなファイルの場合、処理に時間がかかる場合があります
- APIキーには利用制限があるため、頻繁な使用や大量の音声処理には注意が必要です
- 一部の音声形式は変換処理が必要なため、追加のライブラリがインストールされている必要があります（例：ffmpegなど）
- 言語検出は自動で行われないため、音声の言語に合わせて手動で言語を選択する必要があります
- タイムスタンプはGemini APIによる予測であり、実際の音声の正確なタイミングと若干ずれる場合があります

## 更新情報（2024年7月追加）

### 最新バージョンでの改善点

1. **議事録自動生成機能の追加**
   - 文字起こし結果から自動的に議事録を生成する機能を追加しました
   - 会議の情報を構造化して、見やすいマークダウン形式で出力します
   - 議題、決定事項、アクションアイテムなどを自動的に抽出します

2. **UI改善**
   - ウィンドウサイズを大きくし、文字起こし結果と議事録を同時に表示できるようになりました
   - 文字起こし結果と議事録をそれぞれ個別に保存できるボタンを追加しました
   - 議事録表示・保存のためのUIを追加しました

3. **自動保存機能の拡張**
   - 文字起こし結果だけでなく、議事録も自動的に保存できるようになりました
   - 議事録はマークダウン形式(.md)で保存されます

4. **完全な書き起こし処理の保証**
   - 長い音声ファイル（25分以上）の場合、すべてのセグメントが確実に処理されるように改善しました
   - セグメント処理の詳細なログ出力を追加し、処理状況を確認しやすくしました
   - 文字起こし結果が予想より短い場合に自動的に再試行する機能を追加しました

5. **進捗表示の改善**
   - GUI画面に各セグメントの処理状況をリアルタイムで表示するようになりました
   - 処理中のステータスメッセージを詳細にして、ユーザーが進行状況を把握しやすくなりました
   - 音声の総時間と処理済みの割合（%）を表示するようになりました

6. **エラー処理の強化**
   - 文字起こし処理中のエラーに対して自動再試行機能を追加しました（最大3回）
   - エラーメッセージをより詳細に表示するようになりました

これらの改善により、特に長い音声ファイル（60分以上）の場合でも、最後まで確実に書き起こされ、さらに内容を要約した議事録も生成できるようになりました 